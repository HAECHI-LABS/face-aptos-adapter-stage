import type {
  AccountInfo,
  AdapterPlugin,
  NetworkInfo,
  SignMessagePayload,
  SignMessageResponse,
  WalletName,
} from '@aptos-labs/wallet-adapter-core';
import { NetworkName, WalletReadyState } from '@aptos-labs/wallet-adapter-core';
import { Face } from '@haechi-labs/face-sdk';
import { LoginProvider, LoginProviderType, Network } from '@haechi-labs/face-types';
import { Types } from 'aptos';

export const FaceWalletName: WalletName<'FaceWallet'> = 'FaceWallet' as WalletName<'FaceWallet'>;

interface FaceWindow extends Window {
  face?: Face;
}

declare const window: FaceWindow;

const resolveNetworkName = (network: Network): NetworkName => {
  switch (network) {
    case Network.APTOS_TESTNET:
      return NetworkName.Testnet;
    case Network.APTOS:
      return NetworkName.Mainnet;
    default:
      throw new Error('Unsupported Aptos network: ' + network);
  }
};

export class FaceWallet implements AdapterPlugin {
  private readonly faceOauthProviders?: LoginProviderType[];
  readonly name: WalletName<'FaceWallet'> = FaceWalletName;
  readonly url: string = 'https://docs.facewallet.xyz/docs';
  // noinspection JSAnnotator
  readonly icon =
    'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABAAAAAQACAYAAAB/HSuDAAAsO0lEQVR4Ae3dO5BWZbr34afpBvSrkmHSza6aNrEgsifYGMqMnduYz8Ckn1piNmOiJo6ZWs7EiOaCOSqGsgN7R/hFMlVDvBksywN08/X9ti3IgPThPay1/tdV1dXYc3CP8O617t96nmfNtSe+ud0AAACAQdvXAAAAgMETAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAAAAABBAAAAAAIIAAAAABAAAEAAAAAAggAAAAAEEAAAAAAgAACAAAAAAQQAAAAACCAAAAA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AAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAACCAAAAAAQQAAAAACAAAIAAAAABBAAAAAAIIAAAAAAAAEEAAAAAAggAAAAAEAAAQAAAAAC/H+c0K4o4M1t3gAAAABJRU5ErkJggg==';
  readonly providerName = 'FaceWallet';

  provider: Face | undefined = typeof window !== 'undefined' ? window.face : undefined;
  readyState?: WalletReadyState = WalletReadyState.Loadable;

  constructor(face: Face, oauthProviders?: LoginProviderType[]) {
    this.provider = face;
    this.faceOauthProviders =
      !oauthProviders || oauthProviders.length == 0
        ? [
            LoginProvider.Google,
            LoginProvider.Apple,
            LoginProvider.Discord,
            LoginProvider.Facebook,
            LoginProvider.Kakao,
          ]
        : oauthProviders;
  }

  async connect(): Promise<AccountInfo> {
    await this.validateFaceInitialization();

    const response = await this.provider!.auth.login(this.faceOauthProviders);
    if (!response || !response.wallet) {
      throw `Failed to connect account.`;
    }
    const addresses = await this.provider!.aptos.getProvider().getAddresses();
    if (!addresses || addresses.length == 0) {
      throw `Failed to get addresses. Wallet might not be initialized yet.`;
    }

    return {
      address: addresses[0].hex()!,
      publicKey: response.wallet!.eddsaPublicKey!,
    };
  }

  async account(): Promise<AccountInfo> {
    await this.validateFaceInitialization();

    const response = await this.provider!.auth.getCurrentUser();
    if (!response || !response.wallet) {
      throw `Failed to get current account. Might not be logged in.`;
    }
    const addresses = await this.provider!.aptos.getProvider().getAddresses();
    if (!addresses || addresses.length == 0) {
      throw `Failed to get addresses. Wallet might not be initialized yet.`;
    }

    return {
      address: addresses[0].hex()!,
      publicKey: response.wallet.eddsaPublicKey!,
    };
  }

  async disconnect(): Promise<void> {
    await this.validateFaceInitialization();

    await this.provider!.auth.logout();
  }

  async signAndSubmitTransaction(
    transaction: Types.TransactionPayload,
    options?: any
  ): Promise<{ hash: Types.HexEncodedBytes }> {
    await this.validateFaceInitialization();

    if (transaction.type !== 'entry_function_payload') {
      throw `Face wallet only supports transactions of the 'entry function payload' type`;
    }
    const response = await this.provider?.aptos
      .getProvider()
      .signAndSubmitTransaction(
        transaction as Types.TransactionPayload_EntryFunctionPayload,
        options
      );

    if (response) {
      return response as { hash: Types.HexEncodedBytes };
    } else {
      throw `${FaceWalletName} Sign And Submit Transaction failed`;
    }
  }

  async signTransaction(transaction: Types.TransactionPayload, options?: any): Promise<any> {
    await this.validateFaceInitialization();

    if (transaction.type !== 'entry_function_payload') {
      throw `Face wallet only supports transactions of the 'entry function payload' type`;
    }
    const response = await this.provider?.aptos
      .getProvider()
      .signTransaction(transaction as Types.TransactionPayload_EntryFunctionPayload, options);

    if (response) {
      return response;
    } else {
      throw `${FaceWalletName} Sign Transaction failed`;
    }
  }

  async signMessage(message: SignMessagePayload): Promise<SignMessageResponse> {
    await this.validateFaceInitialization();

    if (typeof message !== 'object' || !message.nonce) {
      `${FaceWalletName} Invalid signMessage Payload`;
    }
    const response = await this.provider!.aptos.getProvider().signMessage(message);

    if (response) {
      return response as SignMessageResponse;
    } else {
      throw `${FaceWalletName} Sign Message failed`;
    }
  }

  async network(): Promise<NetworkInfo> {
    await this.validateFaceInitialization();

    const response = await this.provider!.getNetwork();

    if (!response) {
      throw `${FaceWalletName} Network Error`;
    }
    return {
      name: resolveNetworkName(response),
    };
  }

  // Unsupported method
  async onNetworkChange(callback: any): Promise<void> {
    return Promise.resolve();
  }

  // Unsupported method
  async onAccountChange(callback: any): Promise<void> {
    return Promise.resolve();
  }

  async validateFaceInitialization(): Promise<void> {
    if (this.provider == undefined) {
      throw `${FaceWalletName} is not initialized yet`;
    }
  }
}
